[build]
  command   = "npm install && node node_modules/vite/bin/vite.js build"
  publish   = "dist"
  functions = "netlify/functions"

# ── Function settings ──────────────────────────────────────────────
[functions]
  node_bundler = "esbuild"

# Per-function timeout overrides (max 26s on free tier)
# COT fetches 9 CFTC contracts in parallel — needs extra time
[functions."cot-proxy"]
  timeout = 26

[functions."market-proxy"]
  timeout = 20

[functions."yields-proxy"]
  timeout = 20

[functions."cb-rates-proxy"]
  timeout = 20

[functions."calendar-proxy"]
  timeout = 20

[functions."news-proxy"]
  timeout = 26

# ── URL rewrites ───────────────────────────────────────────────────
[[redirects]]
  from = "/api/claude"
  to   = "/.netlify/functions/claude-proxy"
  status = 200

[[redirects]]
  from = "/api/markets"
  to   = "/.netlify/functions/market-proxy"
  status = 200

[[redirects]]
  from = "/api/yields"
  to   = "/.netlify/functions/yields-proxy"
  status = 200

[[redirects]]
  from = "/api/cb-rates"
  to   = "/.netlify/functions/cb-rates-proxy"
  status = 200

[[redirects]]
  from = "/api/cot"
  to   = "/.netlify/functions/cot-proxy"
  status = 200

[[redirects]]
  from = "/api/calendar"
  to   = "/.netlify/functions/calendar-proxy"
  status = 200

[[redirects]]
  from = "/api/news"
  to   = "/.netlify/functions/news-proxy"
  status = 200

[[redirects]]
  from = "/*"
  to   = "/index.html"
  status = 200
